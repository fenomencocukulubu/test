function renderAssignCards() {
  const USE_TEACHER_INTERSECTION = false; // true yaparsanız: grup ∩ herhangi bir öğretmen

  const wrap = document.getElementById("assignCards");
  if (!wrap) return;
  wrap.innerHTML = "";

  const days = state.program.days;
  const S = state.program.slots;

  const groups = Object.values(state.groups).slice()
    .sort((a, b) =>
      (hasAssignmentsForGroup(b.id) ? 1 : 0) - (hasAssignmentsForGroup(a.id) ? 1 : 0) ||
      groupComparator(a, b)
    );

  groups.forEach((g) => {
    const card = document.createElement("div");
    card.className = "card";

    const head = document.createElement("div");
    head.className = "flex";
    const count = state.assignments.filter((a) => a.group === g.id).length;
    head.innerHTML = `
      <b>${g.name}</b>
      <span class="tag">${(g.students || []).length} öğrenci</span>
      <span class="pill">${count} atama</span>`;
    card.appendChild(head);

    const grid = document.createElement("div");
    grid.className = "kgrid";
    grid.style.setProperty("--cols", S);
    grid.dataset.cols = S;

    const headRow = document.createElement("div");
    headRow.className = "kgrid";
    headRow.style.setProperty("--cols", S);
    headRow.appendChild(Object.assign(document.createElement("div"), { textContent: "Gün / Saat", style: "font-weight:700" }));
    for (let s = 0; s < S; s++) {
      const th = document.createElement("div");
      th.className = "kcell";
      th.textContent = (s + 1).toString();
      headRow.appendChild(th);
    }
    grid.appendChild(headRow);

    for (let d = 0; d < days.length; d++) {
      const row = document.createElement("div");
      row.className = "kgrid";
      row.style.setProperty("--cols", S);

      const dayCell = document.createElement("div");
      dayCell.textContent = days[d];
      dayCell.style.fontWeight = "700";
      row.appendChild(dayCell);

      for (let s = 0; s < S; s++) {
        const cell = document.createElement("div");
        cell.className = "kcell";
        cell.dataset.d = d;
        cell.dataset.s = s;

        const cur = state.assignments.find((a) => a.group === g.id && a.day === d && a.slot === s);

        if (cur) {
          cell.classList.add("busy");
          cell.innerHTML = `
            <div style="text-align:center">
              <div>${(state.subjects?.[cur.subjectId]?.name) || ""}</div>
              <div>${(state.teachers?.[cur.teacherId]?.name) || ""}</div>
            </div>`;
        } else {
          // ——— RENKLENDİRME: MÜSAİTLİKLERDEN ———
          const groupAvail = !!(state.availability?.groups?.[g.id]?.[d]?.[s]);
          let ok = groupAvail;

          if (ok && USE_TEACHER_INTERSECTION) {
            // En az bir öğretmen aynı slotta uygun mu?
            const teachers = Object.values(state.teachers || {});
            const anyTeacherFree = teachers.some((t) => !!(state.availability?.teachers?.[t.id]?.[d]?.[s]));
            ok = anyTeacherFree;
          }

          cell.classList.add(ok ? "ok" : "bad");
        }

        cell.onclick = () => openAssignDialog(g.id, d, s);
        row.appendChild(cell);
      }

      grid.appendChild(row);
    }

    card.appendChild(grid);
    wrap.appendChild(card);
  });
}
